---
title: 第七章：最优性条件 (KKT)
date: 2025-12-05 20:00:00 +0800
categories: [学习笔记, 最优化]
tags: [数学, KKT条件, 非线性规划, 期末复习]
math: true
---

本章整理了最优化理论第七章的核心内容。本章聚焦于无约束和约束问题的极值条件，从几何上的下降方向引入，推导至代数上的 **KKT 条件 (Karush-Kuhn-Tucker Conditions)**，这是解决非线性规划问题的核心工具。

## 1. 基础定义与无约束极值

### 1.1 下降方向与可行方向
在讨论极值之前，需要先定义两个核心概念：下降方向（目标函数变小）和可行方向（不跑出约束区域）。

> **定义 7.2.1 (下降方向)**
> 设 $f(x)$ 是定义在 $\mathbb{R}^n$ 上的实函数，$\bar{x} \in \mathbb{R}^n$，$d$ 是非零向量。若存在数 $\delta > 0$，使得对每个 $\lambda \in (0, \delta)$，都有
> $$f(\bar{x} + \lambda d) < f(\bar{x})$$
> 则称 $d$ 为函数 $f(x)$ 在 $\bar{x}$ 处的**下降方向**。

> **定理 7.1.1 (下降方向的判别)**
> 设函数 $f(x)$ 在点 $\bar{x}$ 可微。如果存在方向 $d$，使 **$\nabla f(\bar{x})^T d < 0$**，则 $d$ 是 $f(x)$ 在 $\bar{x}$ 处的下降方向。

> **定义 7.2.2 (可行方向)**
> 设集合 $S \subseteq \mathbb{R}^n$，$\bar{x} \in \text{cl } S$。若存在数 $\delta > 0$，使得对每一个 $\lambda \in (0, \delta)$，都有 $\bar{x} + \lambda d \in S$，则称 $d$ 为集合 $S$ 在 $\bar{x}$ 的**可行方向**。

**关键结论**：如果 $\bar{x}$ 是局部极小点，则在 $\bar{x}$ 处的可行方向一定不是下降方向。即“想变小的地方去不了，去得了的地方不会变小”。

### 1.2 无约束极值条件
考虑问题 $\min f(x), x \in \mathbb{R}^n$。

* **一阶必要条件**：若 $x^*$ 是局部极小点，且 $f$ 可微，则 $\nabla f(x^*) = 0$。
* **二阶充分条件**：若 $\nabla f(x^*) = 0$ 且 Hesse 矩阵 $\nabla^2 f(x^*)$ **正定**，则 $x^*$ 是严格局部极小点。
* **凸函数性质**：对于凸函数，$\nabla f(x^*) = 0$ 是全局极小点的充要条件。

---

## 2. 约束极值的几何条件

考虑一般非线性规划问题：
$$
\begin{aligned}
\min \quad & f(x) \\
\text{s.t.} \quad & g_i(x) \ge 0, \quad i=1,\dots,m \quad (\text{有些教材写作 } \le 0 \text{，需注意符号}) \\
& h_j(x) = 0, \quad j=1,\dots,l
\end{aligned}
$$

定义以下方向锥：
* $F_0 = \{ d \mid \nabla f(\bar{x})^T d < 0 \}$ (下降方向锥)
* $G_0 = \{ d \mid \nabla g_i(\bar{x})^T d > 0, i \in I \}$ (不等式约束的可行方向锥)
* $H_0 = \{ d \mid \nabla h_j(\bar{x})^T d = 0, j=1,\dots,l \}$ (等式约束的切方向)

> **定理 7.2.7 (几何最优性条件)**
> 设 $\bar{x}$ 为可行点。如果 $\bar{x}$ 是局部最优解，且各梯度向量线性无关，则在 $\bar{x}$ 处有：
> $$F_0 \cap G_0 \cap H_0 = \emptyset$$
> 即不存在一个方向，既是下降的，又是可行的。

---

## 3. 代数最优性条件 (从 Fritz John 到 KKT)

将上述几何条件（锥的交集为空）利用 Farkas 引理或分离定理转化为代数形式，即得到乘子定理。

### 3.1 Fritz John 条件 (广义必要条件)
在不引入“约束规范 (Constraint Qualification)”的情况下，我们得到的是 Fritz John 条件。

> **定理 7.2.8 (Fritz John 条件)**
> 设 $\bar{x}$ 是局部最优解。则存在**不全为零**的数 $w_0, w_i (i \in I)$ 和 $v_j (j=1,\dots,l)$，使得：
> $$w_0 \nabla f(\bar{x}) - \sum_{i \in I} w_i \nabla g_i(\bar{x}) - \sum_{j=1}^l v_j \nabla h_j(\bar{x}) = 0$$
> 且 $w_0, w_i \ge 0$。

**注意**：这里多了一个目标函数的乘子 $w_0$。
* 如果 $w_0 = 0$，则最优性条件与目标函数无关，仅由约束决定（通常发生在约束极其尖锐、不满足规范时）。
* 我们希望 $w_0 \neq 0$，从而将其归一化为 1，得到 KKT 条件。

### 3.2 KKT 条件 (一阶必要条件)
为了保证 $w_0 \neq 0$，需要引入**约束规范**，最常用的是 **LICQ (线性独立约束规范)**。

> **定理 7.2.9 (KKT 必要条件)**
> 设 $\bar{x}$ 为可行点，$I = \{ i \mid g_i(\bar{x}) = 0 \}$ 为起作用约束下标集。
> 若向量集 $\{ \nabla g_i(\bar{x}), \nabla h_j(\bar{x}) \mid i \in I, j=1,\dots,l \}$ **线性无关** (LICQ 条件)。
> 如果 $\bar{x}$ 是局部最优解，则存在数 $w_i (i \in I)$ 和 $v_j$，使得：
> $$\nabla f(\bar{x}) - \sum_{i \in I} w_i \nabla g_i(\bar{x}) - \sum_{j=1}^l v_j \nabla h_j(\bar{x}) = 0$$
> 且 $w_i \ge 0$。

**KKT 系统汇总**（解题用）：
设拉格朗日函数 $L(x, w, v) = f(x) - \sum w_i g_i(x) - \sum v_j h_j(x)$。是否存在 $(x, w, v)$ 满足：
1.  **平稳性**：$\nabla_x L = 0$
2.  **原问题可行**：$g_i(x) \ge 0, h_j(x) = 0$
3.  **对偶可行**：$w_i \ge 0$
4.  **互补松弛**：$w_i g_i(x) = 0$ (即 $w_i=0$ 或 $g_i(x)=0$)

---

## 4. 凸规划的充分条件

对于凸规划问题，KKT 条件不仅是必要的，也是充分的。

> **定理 7.2.5 (凸规划充分条件)**
> 设在问题中，$f$ 是凸函数，$g_i$ 是凹函数（这样可行域是凸集）。
> 若 $\bar{x}$ 满足 KKT 条件（存在非负乘子 $w_i$ 满足梯度方程），则 $\bar{x}$ 为**全局最优解**。

---

## 5. 重点习题详解

以下习题均来自教材第七章习题集。

### 习题 1：满足 KKT 条件的点
**题目 (习题 3)**：求满足 KKT 必要条件的点：
$$
\begin{aligned}
\min \quad & 4x_1 - 3x_2 \\
\text{s.t.} \quad & g_1(x) = 4 - x_1 - x_2 \ge 0 \\
& g_2(x) = x_2 + 7 \ge 0 \\
& g_3(x) = -(x_1 - 3)^2 + x_2 + 1 \ge 0
\end{aligned}
$$


**解**：
1.  **KKT 平稳性方程**：
    $$
    \binom{4}{-3} - w_1 \binom{-1}{-1} - w_2 \binom{0}{1} - w_3 \binom{-2(x_1-3)}{1} = 0
    $$
    即：
    $$
    \begin{cases}
    4 + w_1 + 2w_3(x_1-3) = 0 \quad (1) \\
    -3 + w_1 - w_2 - w_3 = 0 \quad (2)
    \end{cases}
    $$
2.  **分析**：
    由 (2) 得 $w_1 = 3 + w_2 + w_3 \ge 3$。因为 $w_1 > 0$，由互补松弛知 $g_1$ 必须取等号，即 **$x_1 + x_2 = 4$**。
    代入 (1)：$2w_3(x_1-3) = -4 - w_1 \le -7$。这意味着 $w_3$ 必不为 0（否则 $0 \le -7$ 矛盾）。
    故 $w_3 > 0$，由互补松弛知 $g_3$ 取等号，即 **$-(x_1-3)^2 + x_2 + 1 = 0$**。
3.  **求解**：
    联立 $x_2 = 4 - x_1$ 与 $g_3=0$：
    $$-(x_1-3)^2 + (4-x_1) + 1 = 0 \implies x_1^2 - 5x_1 + 4 = 0$$
    解得 $x_1 = 1$ 或 $x_1 = 4$。
    * **若 $x_1=4, x_2=0$**：代入 (1) 得 $w_1 + 2w_3 = -4$，无非负解，舍去。
    * **若 $x_1=1, x_2=3$**：此时 $g_2(x) = 10 > 0 \implies w_2=0$。
        解方程组 $\begin{cases} 4 + w_1 - 4w_3 = 0 \\ w_1 - w_3 = 3 \end{cases} \implies w_1=16/3, w_3=7/3$。均非负。
**结论**：唯一 KKT 点为 **$x=(1, 3)^T$**。

### 习题 2：最优解判别
**题目 (习题 4)**：$\min (x_1 - 9/4)^2 + (x_2 - 2)^2$，s.t. $-x_1^2 + x_2 \ge 0, x_1 + x_2 \le 6, x \ge 0$。判别 $x^{(1)} = (3/2, 9/4)^T$ 是否为最优解。

**解**：
检查点 $x^{(1)} = (1.5, 2.25)$：
1.  **可行性**：
    * $g_1: -(1.5)^2 + 2.25 = 0$ (有效约束)
    * $g_2: 6 - 1.5 - 2.25 > 0$ (无效，乘子为0)
    * $x \ge 0$ (严格大于0，乘子为0)
2.  **梯度计算**：
    * $\nabla f = (2(1.5 - 2.25), 2(2.25 - 2))^T = (-1.5, 0.5)^T$
    * $\nabla g_1 = (-2x_1, 1)^T = (-3, 1)^T$
3.  **KKT 方程**：
    $\nabla f = w_1 \nabla g_1 \implies \binom{-1.5}{0.5} = w_1 \binom{-3}{1}$
    解得 $w_1 = 0.5$。
**结论**：存在非负乘子 $w_1=0.5$，故该点是 KKT 点。且目标函数为凸（圆），可行域为凸集，故为**全局最优解**。

### 习题 3：等式与不等式混合求解
**题目 (习题 5)**：求解 $\min x_1^2 - x_2 - 3x_3$，s.t. $-x_1 - x_2 - x_3 \ge 0, x_1^2 + 2x_2 - x_3 = 0$。

**解**：
构造拉格朗日函数：$L = f - w_1 g_1 - v h_1$。
梯度方程：
1.  $2x_1 + w_1 - 2x_1 v = 0$
2.  $-1 + w_1 - 2v = 0$
3.  $-3 + w_1 + v = 0$
联立 (2)(3) 解得 $v = 2/3, w_1 = 7/3$。
因 $w_1 > 0$，故不等式取等号：$-x_1 - x_2 - x_3 = 0$。
代入 (1) 解得 $x_1 = -3.5$。
联立约束求得 $x_2 = -35/12, x_3 = 77/12$。
**结论**：最优解 $x^* = (-3.5, -35/12, 77/12)^T$。

### 习题 4：极大化问题
**题目 (习题 6)**：$\max 14x_1 - x_1^2 + 6x_2 - x_2^2 + 7$，s.t. $x_1+x_2 \le 2, x_1+2x_2 \le 3$。

**解**：
转化为求极小：$\min -f$。
猜测有效约束为 $g_1(x) = 2 - x_1 - x_2 = 0$。
KKT 方程（针对 $\min -f$）：
$$
\binom{2x_1 - 14}{2x_2 - 6} = w_1 \binom{-1}{-1}
$$
解得 $x_1 - x_2 = 4$。联立 $x_1 + x_2 = 2$ 得 $x_1 = 3, x_2 = -1$。
此时 $w_1 = 8 > 0$。检查另一约束 $3 - 3 - 2(-1) = 2 > 0$（满足）。
**结论**：最优解为 $x^* = (3, -1)^T$。

### 习题 5：最小距离问题
**题目 (习题 7)**：求原点到凸集 $S = \{x \mid x_1 + x_2 \ge 4, 2x_1 + x_2 \ge 5\}$ 的最小距离。

**解**：
等价于求解 $\min \frac{1}{2}(x_1^2 + x_2^2)$。
几何投影法：
* 若只考虑 $x_1+x_2=4$，投影点为 $(2,2)$，满足 $2(2)+2 = 6 \ge 5$，可行。距离 $\sqrt{8}$。
* 若只考虑 $2x_1+x_2=5$，投影点为 $(2,1)$，不满足 $x_1+x_2 \ge 4$。
**结论**：最小距离为 $2\sqrt{2}$，对应点 $(2,2)$。

### 习题 6：KKT 条件的应用
**题目**：求解下列非线性规划问题：
$$\min f(x) = (x_1 - 1)^2 + x_2 - 2$$
$$\text{s.t.} \quad g_1(x) = x_2 - x_1 - 1 \ge 0$$
$$\quad \quad g_2(x) = 2 - x_1 - x_2 \ge 0$$

**解**：
1. **构造拉格朗日函数**：
   $$L = (x_1 - 1)^2 + x_2 - 2 - w_1(x_2 - x_1 - 1) - w_2(2 - x_1 - x_2)$$
   *(注意：根据定理 7.2.9 的公式，这里使用减号连接约束项)*

2. **建立 KKT 方程组**：
   * 平稳性：
     $$
     \begin{cases}
     \frac{\partial L}{\partial x_1} = 2(x_1 - 1) + w_1 + w_2 = 0 \\
     \frac{\partial L}{\partial x_2} = 1 - w_1 + w_2 = 0
     \end{cases}
     $$
   * 互补松弛：$w_1 g_1(x) = 0, \quad w_2 g_2(x) = 0$
   * 非负性：$w_1 \ge 0, w_2 \ge 0$

3. **分类讨论求解**：
   * **情形 1 ($w_1=0, w_2=0$)**：
     由 $\frac{\partial L}{\partial x_2} = 1 \ne 0$，矛盾，无解。
   * **情形 2 ($w_1>0, w_2=0$)**：
     $g_1$ 起作用 ($x_2 - x_1 = 1$)。由方程(2)得 $1 - w_1 = 0 \Rightarrow w_1 = 1 > 0$ (合法)。
     代入方程(1)：$2(x_1 - 1) + 1 = 0 \Rightarrow x_1 = 0.5$。进而 $x_2 = 1.5$。
     检验 $g_2$：$2 - 0.5 - 1.5 = 0$，说明 $g_2$ 也恰好满足等号（退化）。
   * **情形 3 ($w_1=0, w_2>0$)**：
     由方程(2)得 $1 + w_2 = 0 \Rightarrow w_2 = -1$，违反 $w \ge 0$，舍去。
   * **情形 4 ($w_1>0, w_2>0$)**：
     两个约束都取等号，解得 $x = (0.5, 1.5)$。代入梯度方程解得 $w_1 = 1, w_2 = 0$。与情形 2 结果一致。

**结论**：唯一 KKT 点为 $x^* = (0.5, 1.5)$。由于目标函数是凸函数（二次函数），约束 $g$ 是线性的（即凹函数），满足定理 7.2.5 的条件，故该点为全局最优解。


